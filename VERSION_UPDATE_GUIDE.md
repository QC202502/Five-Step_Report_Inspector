# 版本更新指南

本文档提供了如何使用 `update_version.py` 脚本进行项目版本更新的详细指南。

## 版本更新流程

当需要发布新版本时，请按照以下步骤操作：

### 1. 准备更新内容

在更新版本之前，请确保：
- 所有代码更改已完成并测试
- 已经决定好新版本号（遵循语义化版本规范：主版本.次版本.修订版本）
- 已准备好新版本的更新内容描述（新功能、改进和修复）

### 2. 运行版本更新脚本

使用以下命令运行版本更新脚本：

```bash
./update_version.py 新版本号 [--features "功能1;功能2"] [--improvements "改进1;改进2"] [--fixes "修复1;修复2"]
```

例如：

```bash
./update_version.py 0.4.2 --features "添加DeepSeek分析结果导出功能;优化研报详情页面布局" --improvements "提高分析速度;改进错误处理" --fixes "修复分析结果显示问题;解决数据库连接泄漏"
```

### 3. 确认更新

脚本会显示当前版本和新版本，并询问是否继续。输入 `y` 确认更新。

### 4. 脚本执行的操作

脚本会自动执行以下操作：

1. 更新 `VERSION` 文件中的版本号
2. 更新 `app.py` 中的 `VERSION` 常量
3. 更新 `README.md` 中的版本号标记
4. 在 `CHANGELOG.md` 中添加新版本的更新记录
5. 创建 `database_update_vX.X.X.md` 文件模板
6. 创建 `git_push_vX.X.X.sh` 推送脚本
7. 更新 `GIT_PUSH_README.md` 文件
8. 创建数据库备份目录

### 5. 完成后续步骤

脚本执行完成后，您需要手动完成以下步骤：

1. 编辑 `database_update_vX.X.X.md` 文件，填写实际的数据库更新内容
2. 创建数据库备份并放入备份目录
3. 使用 Git 添加并提交所有更改：
   ```bash
   git add .
   git commit -m "版本更新: v新版本号"
   ```
4. 使用生成的推送脚本推送到远程仓库：
   ```bash
   ./git_push_vX.X.X.sh
   ```

### 6. 验证更新

推送完成后，验证以下内容：
- 远程仓库是否显示最新提交
- `VERSION` 文件是否已更新为新版本号
- `CHANGELOG.md` 中是否包含新版本的更新记录
- `database_update_vX.X.X.md` 文件是否已添加到仓库中

## 版本号规范

项目使用语义化版本规范（SemVer）：

- **主版本号**：当做了不兼容的API修改时增加
- **次版本号**：当做了向下兼容的功能性新增时增加
- **修订号**：当做了向下兼容的问题修正时增加

例如：从 `0.4.1` 升级到 `0.4.2` 表示做了兼容性修复，从 `0.4.1` 升级到 `0.5.0` 表示添加了新功能。

## 文件更新说明

### VERSION 文件
包含当前版本号的纯文本文件。

### app.py
包含硬编码的版本常量：`VERSION = "x.x.x"`。

### README.md
包含版本号标记：`[![版本](https://img.shields.io/badge/版本-x.x.x-blue.svg)]`。

### CHANGELOG.md
记录所有版本的更新内容，按版本号降序排列。

### database_update_vX.X.X.md
记录特定版本的数据库更新内容，包括新增研报、分析结果等。

### GIT_PUSH_README.md
提供版本推送指南，包括更新内容摘要和推送步骤。

### git_push_vX.X.X.sh
用于推送特定版本更新的脚本。 